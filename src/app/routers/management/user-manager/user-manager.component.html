<div class="list-wrap">
  <app-page-header></app-page-header>

  <div class="content-wrapper">
    <div class="list-container" dLoading [loading]="loading" [backdrop]="true">
      <div class="list-content">
        <d-data-table [dataSource]="userList" [scrollable]="true" [tableWidthConfig]="tableWidthConfig">
          <thead dTableHead>
            <tr dTableRow>
              <th dHeadCell>#</th>
              <th dHeadCell *ngFor="let column of tableColumns"> {{ column.header }} </th>
              <th dHeadCell>操作</th>
            </tr>
          </thead>
          <tbody dTableBody>
            <ng-template let-rowItem="rowItem" let-rowIndex="rowIndex">
              <tr dTableRow *ngIf="rowIndex === 0">
                <td dTableCell [attr.colspan]="tableColumns.length + 2">
                  <div *ngIf="!showCreateForm" (click)="openCreateUserForm()" class="cursor-pointer" tabindex="0" (keyup.enter)="openCreateUserForm()">
                    <span class="tips-icon icon-add"></span>
                    <span style="margin-left: 10px">新建用户</span>
                  </div>
                  <div *ngIf="showCreateForm" class="edit-padding-fix">
                    <app-page-form
                      [formConfig]="formConfig"
                      [formData]="defaultRowData"
                      [formValue]="formRowData"
                      [loading]="formLoading"
                      class="editable-row"
                      (submitted)="createUser($event)"
                      (canceled)="closeCreateUserForm()"
                    ></app-page-form>
                  </div>
                </td>
              </tr>
              <tr dTableRow>
                <td dTableCell>{{ rowIndex + 1 }}</td>
                <td dTableCell *ngFor="let column of tableColumns">
                  <span *ngIf="column.fieldType === 'text'">{{ rowItem[column.field] }}</span>
                  <d-tag
                    *ngIf="column.fieldType === 'tag'"
                    [tag]="tagTitleTranslate(column.field, rowItem[column.field])"
                    [labelStyle]="column.field + '-' + rowItem[column.field]"
                  ></d-tag>
                  <span *ngIf="column.fieldType === 'date'">{{ rowItem[column.field] | date : 'yyyy-MM-dd' }}</span>
                </td>
                <td>
                  <d-button icon="icon-edit" bsStyle="text-dark" title="edit" (click)="openEditUserForm(rowItem)"></d-button>
                  <d-button icon="icon-delete" bsStyle="text-dark" title="delete" (click)="openDeleteUserForm(rowItem)"></d-button>
                </td>
              </tr>
            </ng-template>
          </tbody>
        </d-data-table>
      </div>
      <div class="list-footer">
        <d-pagination
          [size]="'sm'"
          [total]="pager.total"
          [(pageSize)]="pager.limit"
          [(pageIndex)]="pager.index"
          [canViewTotal]="true"
          [canChangePageSize]="true"
          [canJumpPage]="true"
          [maxItems]="5"
          (pageIndexChange)="onPageChange($event)"
          (pageSizeChange)="onSizeChange($event)"
        >
        </d-pagination>
      </div>
    </div>
  </div>
</div>
<ng-template #editorTemplate>
  <app-page-form [formConfig]="editFormConfig" [formData]="editDefaultRowData" [loading]="formLoading" (submitted)="editUser($event)" (canceled)="closeEditUserForm()">
  </app-page-form>
</ng-template>
